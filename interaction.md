# Ansible 管理平台交互文档

## 1. 登录流程

1.  **用户** 打开浏览器，访问平台首页。
2.  **系统** 显示登录页面，包含用户名和密码输入框。
3.  **用户** 输入用户名和密码，点击“登录”按钮。
4.  **前端** 将用户名和密码发送到后端 `/api/v1/login` 接口。
5.  **后端** 验证用户凭证。
    -   如果验证成功，生成一个 JWT 并返回给前端。
    -   如果验证失败，返回错误信息。
6.  **前端** 接收到 JWT，将其存储在本地（例如 `localStorage`），并跳转到应用主界面（仪表盘）。
7.  **前端** 在后续的所有 API 请求中，都在请求头中附带此 JWT。

## 2. 执行 Ansible 任务流程

1.  **用户** 在导航菜单中点击“项目”，进入项目列表页面。
2.  **系统** 显示所有项目的列表。
3.  **用户** 点击一个项目，进入该项目的详情页面。
4.  **系统** 显示该项目的详细信息，包括可用的 Playbook 列表。
5.  **用户** 选择一个 Playbook，点击“启动”按钮。
6.  **系统** 弹出一个配置对话框，允许用户：
    -   选择一个 Inventory。
    -   输入额外的变量 (`extra-vars`)。
    -   设置 `limit`, `tags` 等参数。
7.  **用户** 填写完配置，点击“确认启动”。
8.  **前端** 将 Playbook 名称和所有配置参数发送到后端 `POST /api/v1/projects/{project_id}/launch` 接口。
9.  **后端** 创建一个新的任务记录，状态为“pending”，并将其放入任务队列。
10. **任务执行器** 从队列中获取任务，开始异步执行 Ansible Playbook。
11. **后端** 立即返回新创建的任务 ID 给前端。
12. **前端** 自动跳转到该任务的详情页面 (`/tasks/{task_id}`)。
13. **系统** 在任务详情页面通过 WebSocket 或轮询 `GET /api/v1/tasks/{task_id}` 接口，实时显示 Ansible 的输出日志。
14. **任务执行器** 在任务执行完毕后，将最终状态（“successful”或“failed”）和完整的输出更新到数据库。
15. **系统** 在任务详情页面显示最终的任务结果。